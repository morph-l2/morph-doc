"use strict";(self.webpackChunkmorph_doc=self.webpackChunkmorph_doc||[]).push([[4766],{3499:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=n(6070),s=n(1582);const o={title:"Rollup",lang:"en-US",keywords:["morph","ethereum","rollup"],description:"Explain how rollup process works in Morph"},r=void 0,a={id:"how-morph-works/general-protocol-design/rollup",title:"Rollup",description:"Explain how rollup process works in Morph",source:"@site/docs/how-morph-works/general-protocol-design/1-rollup.md",sourceDirName:"how-morph-works/general-protocol-design",slug:"/how-morph-works/general-protocol-design/rollup",permalink:"/docs/how-morph-works/general-protocol-design/rollup",draft:!1,unlisted:!1,editUrl:"https://github.com/morph-l2/morph-doc/tree/main/docs/how-morph-works/general-protocol-design/1-rollup.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Rollup",lang:"en-US",keywords:["morph","ethereum","rollup"],description:"Explain how rollup process works in Morph"}},l={},c=[{value:"An overview of Morph Rollup Design:",id:"an-overview-of-morph-rollup-design",level:3},{value:"Constructing the Batch\u200b",id:"constructing-the-batch",level:2},{value:"Putting Multiple Batches into a Single Rollup Transaction\u200b",id:"putting-multiple-batches-into-a-single-rollup-transaction",level:2},{value:"Submitting Batch Data to the Rollup Contract\u200b",id:"submitting-batch-data-to-the-rollup-contract",level:2},{value:"Finalize the batches",id:"finalize-the-batches",level:2},{value:"What is Batch Submitter?",id:"what-is-batch-submitter",level:2},{value:"What is the relationship between Sequencers &amp; Batch Submitters\uff1f",id:"what-is-the-relationship-between-sequencers--batch-submitters",level:2},{value:"How to decentralize the Batch Submitter\uff1f",id:"how-to-decentralize-the-batch-submitter",level:2},{value:"Submitter Rotation",id:"submitter-rotation",level:3},{value:"Timeout",id:"timeout",level:3},{value:"Penalties for Timeout",id:"penalties-for-timeout",level:3},{value:"Module Design",id:"module-design",level:2},{value:"Layer1",id:"layer1",level:3},{value:"Layer2",id:"layer2",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.admonition,{type:"info",children:[(0,i.jsx)(t.p,{children:'As the foundation of a Layer 2 project, the "Rollup" process refers to the method by which Layer 2 assembles L2 transactions and state into batches and subsequently submits them to L1, along with the L2 state.'}),(0,i.jsxs)(t.p,{children:["Within ",(0,i.jsx)(t.a,{href:"/docs/how-morph-works/morph-modular-design",children:"Morph's architecture"}),", this Rollup process is executed by the ",(0,i.jsx)(t.code,{children:"Batch Submitter"})," components."]})]}),"\n",(0,i.jsx)(t.h3,{id:"an-overview-of-morph-rollup-design",children:"An overview of Morph Rollup Design:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"rollup",src:n(309).A+"",width:"1920",height:"1080"})}),"\n",(0,i.jsx)(t.h2,{id:"constructing-the-batch",children:"Constructing the Batch\u200b"}),"\n",(0,i.jsx)(t.p,{children:"The L2 Node within the sequencer generates L2 blocks based on consensus results and updates the local state of L2. The batch submitter must query the L2 node to retrieve the latest L2 blocks."}),"\n",(0,i.jsx)(t.p,{children:"The batch submitter then reconstructs L2 blocks, compiling:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Transactions: All transactions contained within the blocks."}),"\n",(0,i.jsx)(t.li,{children:"Blockinfo : Essential information from each block."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The batch submitter continues fetching and reconstructing blocks until it processes a block with a BLS signature, indicating the batch point has been reached. The reconstructed block data is used to construct a batch, which contains:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"lastBlocknumber : The number of the final block in the batch."}),"\n",(0,i.jsx)(t.li,{children:"Transactions : Encoded transactions within the batch."}),"\n",(0,i.jsx)(t.li,{children:"BlockWitness : Encoded blockinfos, utilized for zkProof."}),"\n",(0,i.jsx)(t.li,{children:"PreStateRoot : The stateRoot before the batch is applied."}),"\n",(0,i.jsx)(t.li,{children:"PostStateRoot : The stateRoot after the batch is applied."}),"\n",(0,i.jsx)(t.li,{children:"WithdrawalRoot : L2 withdrawal Merkle tree root."}),"\n",(0,i.jsx)(t.li,{children:"Signature : The batch\u2019s BLS signature."}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"Blockinfo (BlockWitness) is needed since Morph employs zk technology to prove the accuracy of submitted batch data. It serves as a witness in the Zero-Knowledge Proof."})}),"\n",(0,i.jsx)(t.h2,{id:"putting-multiple-batches-into-a-single-rollup-transaction",children:"Putting Multiple Batches into a Single Rollup Transaction\u200b"}),"\n",(0,i.jsx)(t.p,{children:"While it's standard for roll-up projects to include only one batch per L1 roll-up transaction, Morph optimizes by inserting as many batches as feasible into a single L1 transaction.\nThis efficiency-driven approach significantly reduces overall costs, as the L1 fee is a predominant component of the transaction costs associated with the L2. By optimizing the utilization of available space, Morph achieves cost-effectiveness without compromising transaction integrity."}),"\n",(0,i.jsx)(t.h2,{id:"submitting-batch-data-to-the-rollup-contract",children:"Submitting Batch Data to the Rollup Contract\u200b"}),"\n",(0,i.jsx)(t.p,{children:"The batch submitter will eventually send an Ethereum transaction from its L1 account to Morph's main contract."}),"\n",(0,i.jsx)(t.p,{children:"The transaction's calldata contains the batch data."}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"Based on the development process of ERC-4337, future batch data will likely be incorporated into a new \u2018blob\u2019 structure to further decrease costs."})}),"\n",(0,i.jsx)(t.p,{children:"Once the transaction is submitted and confirmed on Ethereum, validator nodes can reconstruct and verify the validity of sequencers' submissions using the transactional data within the batch."}),"\n",(0,i.jsx)(t.h2,{id:"finalize-the-batches",children:"Finalize the batches"}),"\n",(0,i.jsxs)(t.p,{children:["If batches are valid according to Morph's ",(0,i.jsx)(t.a,{href:"/docs/how-morph-works/optimistic-zkevm",children:"responsive validity proof"})," standards, all transactions within the batches will be finalized, including withdrawal transactions."]}),"\n",(0,i.jsx)(t.p,{children:"Consequently, withdrawal requests will be fulfilled, and the corresponding locked assets on Layer 1 will be released."}),"\n",(0,i.jsx)(t.h1,{id:"decentralize-batch-submitter",children:"Decentralize Batch Submitter"}),"\n",(0,i.jsx)(t.h2,{id:"what-is-batch-submitter",children:"What is Batch Submitter?"}),"\n",(0,i.jsx)(t.p,{children:'A Batch Submitter plays a crucial role in the "rollup" process, acting as the bridge that connects Layer 2 (L2) data with Ethereum (Layer 1 or L1). Their primary responsibilities include:'}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Collecting L2 transactions and block data, assembling them into a cohesive batch."}),"\n",(0,i.jsx)(t.li,{children:"Embedding this batch data within a Layer 1 transaction."}),"\n",(0,i.jsx)(t.li,{children:"Executing this transaction by calling the Layer 1 contract to complete the rollup process."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"rollup",src:n(309).A+"",width:"1920",height:"1080"})}),"\n",(0,i.jsx)(t.h2,{id:"what-is-the-relationship-between-sequencers--batch-submitters",children:"What is the relationship between Sequencers & Batch Submitters\uff1f"}),"\n",(0,i.jsx)(t.p,{children:"The Batch submitter function is often integrated within the broader 'sequencer' role. In a decentralized sequencer network architecture, each sequencer is equipped with or has access to a batch submitter component. This integration is key to achieving and maintaining the highest levels of decentralization."}),"\n",(0,i.jsx)(t.p,{children:"This structure ensures that the data uploaded to Layer 1 remains decentralized, preventing a single entity from controlling the rollup process."}),"\n",(0,i.jsx)(t.h2,{id:"how-to-decentralize-the-batch-submitter",children:"How to decentralize the Batch Submitter\uff1f"}),"\n",(0,i.jsx)(t.p,{children:"To uphold the aforementioned principles, it is essential to ensure that multiple sequencers can share rollup tasks evenly within the same time frame. Our approach to achieving this involves a rotation system for sequencers to take turns with the responsibility of calling the batch submitter, as detailed below:"}),"\n",(0,i.jsx)(t.h3,{id:"submitter-rotation",children:"Submitter Rotation"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Epoch Cycle Role Switching"}),": Sequencers alternate roles as batch submitters within an established Epoch cycle."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Cross-Epoch Execution Capability"}),": Any Sequencer can perform a Rollup for another Sequencer's Epoch."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Timeout Logging"}),": The system records instances when not a single rollup happens during an epoch, the epoch will be marked as \u201ctimeout\u201d as well as the responsible sequencer."]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"timeout",children:"Timeout"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Timeout Identification"}),': If an epoch passes without a rollup (batch submission), it\'s identified as a "timeout." The timing of a rollup is pegged to the confirmation time of the Layer 1 rollup transaction.']}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Epoch Rotation"}),": The duration of an epoch and the rotation schedule are governed by the sequencer network governance. Sequencers are assigned indexes which determine their responsibility for an epoch. With changes in the sequencer set, indexes are reassigned, and epochs rotate accordingly based on these new assignments."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"penalties-for-timeout",children:"Penalties for Timeout"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Accumulated Penalties"}),": Sequencers that frequently exhibit timeout behaviors may face penalties that related to their Layer 1 ETH staking, if the timeout records reaches to a certain level, sequencer may/will be slashed from the sequencer network."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"module-design",children:"Module Design"}),"\n",(0,i.jsx)(t.p,{children:"Below you can find the contracts that are responsible for each module and their responsibilities:"}),"\n",(0,i.jsx)(t.h3,{id:"layer1",children:"Layer1"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"RollupContract"}),": records the rollup executor and sync with L2"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"layer2",children:"Layer2"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"SequencerContract"}),": Sync Sequencers"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"GovContract"}),": Manage Batch & Epoch Parameters"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"SubmitterContract"}),":","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Record Epoch information"}),"\n",(0,i.jsx)(t.li,{children:"Record Rollup history"}),"\n",(0,i.jsx)(t.li,{children:"Record Submitter Workload"}),"\n",(0,i.jsx)(t.li,{children:"Record Submitter Timeouts"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"IncentiveContract"}),": Conducts Incentive and Penalty actions"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},309:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/rollup-768caf2d310d19ce9909d718badd44e5.png"},1582:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var i=n(758);const s={},o=i.createContext(s);function r(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);